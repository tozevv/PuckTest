<html>
 <head>
   <script src="https://www.puck-js.com/puck.js"></script>
   
   <script type="text/javascript">
    
    // Called when we get a line of data 
    function onLine(v) {
      if (v.indexOf("Pressed")>=0)
       console.log("Button pressed!");
    }
    
    // When clicked, connect or disconnect

    var connection;    
    function connect() {
        if (connection) {
          connection.close();
          connection = undefined;
        }
        Puck.connect(function(c) {
          if (!c) {
            alert("Couldn't connect!");
            return;
          }
          connection = c;
          // Handle the data we get back, and call 'onLine'
          // whenever we get a complete line
          var buf = "";
          connection.on("data", function(d) {
            buf += d;
            var i = buf.indexOf("\n");
            while (i>=0) {
              onLine(buf.substr(0,i));
              buf = buf.substr(i+1);
              i = buf.indexOf("\n");
            }
          });
          // First, reset Puck.js
          connection.write("reset();\n", function() {
                // Wait for it to reset itself
                setTimeout(function() {
                  // Now tell it to print text whenever the button is pressed
                  connection.write('\x10setWatch(function(Â­) {console.log("Pressed");}, BTN, { edge: "rising", debounce: 10, repeat: true });\n',
                    function() { console.log("Ready..."); });
                 
                }, 1500);
              });
        ]);
    }
  </script>
 </head>
 <body>
  <h1>K8s test</h1>
 
  <button id="connect_button" onClick="connect()">Connect!</button>
  
    
 </body>
</html>
